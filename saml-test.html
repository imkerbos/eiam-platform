<!DOCTYPE html>
<html>
<head>
    <title>SAML IdP æµ‹è¯•é¡µé¢</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .container { max-width: 800px; margin: 0 auto; }
        .endpoint { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .test-form { background: #e8f4f8; padding: 20px; border-radius: 5px; margin: 20px 0; }
        button { background: #007cba; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #005a87; }
        .info { background: #fff3cd; padding: 15px; border-radius: 5px; margin: 15px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” EIAM SAML IdP æµ‹è¯•é¡µé¢</h1>
        
        <div class="info">
            <h3>ğŸ“‹ SAMLç«¯ç‚¹ä¿¡æ¯</h3>
            <div class="endpoint">
                <strong>å…ƒæ•°æ® URL (é€šè¿‡å‰ç«¯ä»£ç†):</strong><br>
                <a href="http://localhost:3000/saml/metadata" target="_blank">
                    http://localhost:3000/saml/metadata
                </a>
            </div>
            <div class="endpoint">
                <strong>SSO URL (é€šè¿‡å‰ç«¯ä»£ç†):</strong><br>
                http://localhost:3000/saml/sso
            </div>
            <div class="endpoint">
                <strong>SLS URL (é€šè¿‡å‰ç«¯ä»£ç†):</strong><br>
                http://localhost:3000/saml/sls
            </div>
        </div>

        <div class="test-form">
            <h3>ğŸ§ª å¿«é€Ÿæµ‹è¯•</h3>
            <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æµ‹è¯•SAMLå…ƒæ•°æ®æ˜¯å¦æ­£å¸¸å·¥ä½œï¼š</p>
            <button onclick="testMetadata()">æµ‹è¯•å…ƒæ•°æ®ç«¯ç‚¹</button>
            <button onclick="testSSO()">æµ‹è¯•SSOç«¯ç‚¹</button>
            
            <div id="result" style="margin-top: 20px;"></div>
        </div>

        <div class="info">
            <h3>ğŸ“– ä½¿ç”¨è¯´æ˜</h3>
            <ol>
                <li><strong>å¯åŠ¨åç«¯æœåŠ¡å™¨:</strong> <code>go run cmd/server/main.go</code></li>
                <li><strong>å¯åŠ¨å‰ç«¯æœåŠ¡å™¨:</strong> <code>cd frontend && npm run dev</code></li>
                <li><strong>è®¿é—®ç®¡ç†ç•Œé¢:</strong> <a href="http://localhost:3000" target="_blank">http://localhost:3000</a></li>
                <li><strong>é…ç½®SAMLåº”ç”¨:</strong> æ§åˆ¶å° â†’ åº”ç”¨ç¨‹åº â†’ æ·»åŠ åº”ç”¨ç¨‹åº â†’ é€‰æ‹©SAML</li>
                <li><strong>ä¸‹è½½å…ƒæ•°æ®:</strong> ç‚¹å‡»ä¸Šé¢çš„"æµ‹è¯•å…ƒæ•°æ®ç«¯ç‚¹"æŒ‰é’®</li>
            </ol>
        </div>

        <div class="info">
            <h3>ğŸ”— é›†æˆæ­¥éª¤</h3>
            <h4>å¯¹äºService Provider (SP)åº”ç”¨:</h4>
            <ol>
                <li>è·å–IdPå…ƒæ•°æ®: <code>curl http://localhost:3000/saml/metadata</code></li>
                <li>åœ¨SPä¸­é…ç½®IdPå…ƒæ•°æ®</li>
                <li>åœ¨EIAMä¸­æ³¨å†ŒSP (Entity ID, ACS URLç­‰)</li>
                <li>æµ‹è¯•SAMLç™»å½•æµç¨‹</li>
            </ol>
        </div>
    </div>

    <script>
        async function testMetadata() {
            const result = document.getElementById('result');
            result.innerHTML = '<p>â³ æ­£åœ¨æµ‹è¯•å…ƒæ•°æ®ç«¯ç‚¹...</p>';
            
            try {
                const response = await fetch('http://localhost:3000/saml/metadata');
                if (response.ok) {
                    const metadata = await response.text();
                    result.innerHTML = `
                        <div style="background: #d4edda; padding: 15px; border-radius: 5px;">
                            <h4>âœ… å…ƒæ•°æ®ç«¯ç‚¹æ­£å¸¸å·¥ä½œ!</h4>
                            <p><strong>çŠ¶æ€ç :</strong> ${response.status}</p>
                            <p><strong>å†…å®¹ç±»å‹:</strong> ${response.headers.get('content-type')}</p>
                            <details>
                                <summary>æŸ¥çœ‹å…ƒæ•°æ®å†…å®¹</summary>
                                <pre style="background: #f8f9fa; padding: 10px; overflow-x: auto;">${metadata}</pre>
                            </details>
                        </div>
                    `;
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                result.innerHTML = `
                    <div style="background: #f8d7da; padding: 15px; border-radius: 5px;">
                        <h4>âŒ å…ƒæ•°æ®ç«¯ç‚¹æµ‹è¯•å¤±è´¥</h4>
                        <p><strong>é”™è¯¯:</strong> ${error.message}</p>
                        <p><strong>å»ºè®®:</strong> è¯·ç¡®ä¿åç«¯æœåŠ¡å™¨å·²å¯åŠ¨ (go run cmd/server/main.go)</p>
                    </div>
                `;
            }
        }

        function testSSO() {
            const result = document.getElementById('result');
            result.innerHTML = `
                <div style="background: #cce5ff; padding: 15px; border-radius: 5px;">
                    <h4>â„¹ï¸ SSOæµ‹è¯•è¯´æ˜</h4>
                    <p>SSOç«¯ç‚¹éœ€è¦æœ‰æ•ˆçš„SAMLè¯·æ±‚æ‰èƒ½æµ‹è¯•ã€‚æ‚¨å¯ä»¥:</p>
                    <ol>
                        <li>ä½¿ç”¨åœ¨çº¿å·¥å…·å¦‚ <a href="https://samltest.id" target="_blank">samltest.id</a></li>
                        <li>é…ç½®ä¸€ä¸ªçœŸå®çš„SPåº”ç”¨</li>
                        <li>ä½¿ç”¨SAMLæµ‹è¯•å·¥å…·ç”ŸæˆAuthnRequest</li>
                    </ol>
                    <p><strong>SSO URL:</strong> http://localhost:3000/saml/sso</p>
                </div>
            `;
        }
    </script>
</body>
</html>
