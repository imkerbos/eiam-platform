<!DOCTYPE html>
<html>
<head>
    <title>SAML è°ƒè¯•æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-box { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
        button { background: #007cba; color: white; padding: 8px 15px; border: none; border-radius: 3px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>ğŸ” SAML è°ƒè¯•æµ‹è¯•</h1>
    
    <div class="test-box">
        <h3>æµ‹è¯•æ­¥éª¤ï¼š</h3>
        <button onclick="testBackendDirect()">1. æµ‹è¯•åç«¯ç›´æ¥è®¿é—® (8080)</button>
        <button onclick="testFrontendProxy()">2. æµ‹è¯•å‰ç«¯ä»£ç† (3000)</button>
        <button onclick="testOtherProxies()">3. æµ‹è¯•å…¶ä»–ä»£ç†ç«¯ç‚¹</button>
    </div>

    <div id="results"></div>

    <script>
        async function testBackendDirect() {
            addResult("â³ æµ‹è¯•åç«¯ç›´æ¥è®¿é—® http://localhost:8080/saml/metadata");
            try {
                const response = await fetch('http://localhost:8080/saml/metadata');
                if (response.ok) {
                    const data = await response.text();
                    addResult(`âœ… åç«¯ç›´æ¥è®¿é—®æˆåŠŸ! çŠ¶æ€: ${response.status}`, 'success');
                    addResult(`å“åº”é•¿åº¦: ${data.length} å­—ç¬¦`, 'success');
                } else {
                    addResult(`âŒ åç«¯ç›´æ¥è®¿é—®å¤±è´¥! çŠ¶æ€: ${response.status}`, 'error');
                }
            } catch (error) {
                addResult(`âŒ åç«¯ç›´æ¥è®¿é—®é”™è¯¯: ${error.message}`, 'error');
                addResult(`ğŸ’¡ è¯·ç¡®ä¿åç«¯æœåŠ¡å™¨å·²å¯åŠ¨: go run cmd/server/main.go`, 'error');
            }
        }

        async function testFrontendProxy() {
            addResult("â³ æµ‹è¯•å‰ç«¯ä»£ç† http://localhost:3000/saml/metadata");
            try {
                const response = await fetch('http://localhost:3000/saml/metadata');
                if (response.ok) {
                    const data = await response.text();
                    addResult(`âœ… å‰ç«¯ä»£ç†è®¿é—®æˆåŠŸ! çŠ¶æ€: ${response.status}`, 'success');
                    addResult(`å“åº”é•¿åº¦: ${data.length} å­—ç¬¦`, 'success');
                } else {
                    addResult(`âŒ å‰ç«¯ä»£ç†è®¿é—®å¤±è´¥! çŠ¶æ€: ${response.status}`, 'error');
                    if (response.status === 404) {
                        addResult(`ğŸ’¡ 404é”™è¯¯å¯èƒ½åŸå› :`, 'error');
                        addResult(`1. å‰ç«¯æœåŠ¡å™¨éœ€è¦é‡å¯ä»¥åº”ç”¨ä»£ç†é…ç½®`, 'error');
                        addResult(`2. åç«¯SAMLè·¯ç”±æœªæ­£ç¡®æ³¨å†Œ`, 'error');
                    }
                }
            } catch (error) {
                addResult(`âŒ å‰ç«¯ä»£ç†è®¿é—®é”™è¯¯: ${error.message}`, 'error');
            }
        }

        async function testOtherProxies() {
            const endpoints = [
                'http://localhost:3000/api/v1/site-info',
                'http://localhost:3000/public/site-info',
                'http://localhost:3000/cas/login'
            ];

            for (const endpoint of endpoints) {
                addResult(`â³ æµ‹è¯•å…¶ä»–ä»£ç†ç«¯ç‚¹: ${endpoint}`);
                try {
                    const response = await fetch(endpoint);
                    addResult(`${response.ok ? 'âœ…' : 'âŒ'} ${endpoint} - çŠ¶æ€: ${response.status}`, response.ok ? 'success' : 'error');
                } catch (error) {
                    addResult(`âŒ ${endpoint} - é”™è¯¯: ${error.message}`, 'error');
                }
            }
        }

        function addResult(message, type = '') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test-box ${type}`;
            div.innerHTML = `<p>${message}</p>`;
            results.appendChild(div);
            results.scrollTop = results.scrollHeight;
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºè¯´æ˜
        window.onload = function() {
            addResult("ğŸ“‹ è°ƒè¯•è¯´æ˜:");
            addResult("1. é¦–å…ˆæµ‹è¯•åç«¯ç›´æ¥è®¿é—®ï¼Œç¡®è®¤SAMLç«¯ç‚¹å·¥ä½œæ­£å¸¸");
            addResult("2. ç„¶åæµ‹è¯•å‰ç«¯ä»£ç†ï¼Œç¡®è®¤ä»£ç†é…ç½®æ­£ç¡®");
            addResult("3. å¦‚æœå‰ç«¯ä»£ç†404ï¼Œè¯·é‡å¯å‰ç«¯æœåŠ¡å™¨: Ctrl+C ç„¶å npm run dev");
        };
    </script>
</body>
</html>
