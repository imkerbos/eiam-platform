<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯†ç ç­–ç•¥æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .success { color: green; }
        .error { color: red; }
        .warning { color: orange; }
        .info { color: blue; }
        pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            border: 1px solid #ddd;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        input, select {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
            width: 200px;
        }
        .password-strength {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .strength-1, .strength-2 { background: #ffebee; border: 1px solid #f44336; }
        .strength-3 { background: #fff3e0; border: 1px solid #ff9800; }
        .strength-4 { background: #e3f2fd; border: 1px solid #2196f3; }
        .strength-5 { background: #e8f5e8; border: 1px solid #4caf50; }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .policy-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
    </style>
</head>
<body>
    <h1>ğŸ” å¯†ç ç­–ç•¥åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>1. ç™»å½•è·å–Token</h2>
        <button onclick="login()">ç™»å½•</button>
        <div id="login-result"></div>
    </div>

    <div class="test-section">
        <h2>2. è·å–å½“å‰å¯†ç ç­–ç•¥</h2>
        <button onclick="getPasswordPolicy()">è·å–ç­–ç•¥</button>
        <div id="policy-result"></div>
    </div>

    <div class="test-section">
        <h2>3. å¯†ç éªŒè¯æµ‹è¯•</h2>
        <div>
            <label>ç”¨æˆ·å:</label>
            <input type="text" id="username" value="admin" placeholder="è¾“å…¥ç”¨æˆ·å">
        </div>
        <div>
            <label>å¯†ç :</label>
            <input type="password" id="password" placeholder="è¾“å…¥è¦éªŒè¯çš„å¯†ç ">
        </div>
        <button onclick="validatePassword()">éªŒè¯å¯†ç </button>
        <div id="validation-result"></div>
    </div>

    <div class="test-section">
        <h2>4. å¯†ç ç”Ÿæˆæµ‹è¯•</h2>
        <button onclick="generatePassword()">ç”Ÿæˆå¼ºå¯†ç </button>
        <div id="generate-result"></div>
    </div>

    <div class="test-section">
        <h2>5. æ›´æ–°å¯†ç ç­–ç•¥</h2>
        <div class="grid">
            <div>
                <h3>å¯†ç é•¿åº¦</h3>
                <div class="policy-item">
                    <label>æœ€å°é•¿åº¦:</label>
                    <input type="number" id="minLength" value="8" min="6" max="20">
                </div>
                <div class="policy-item">
                    <label>æœ€å¤§é•¿åº¦:</label>
                    <input type="number" id="maxLength" value="128" min="20" max="256">
                </div>
            </div>
            <div>
                <h3>å­—ç¬¦è¦æ±‚</h3>
                <div class="policy-item">
                    <label>å¤§å†™å­—æ¯:</label>
                    <input type="checkbox" id="requireUpper" checked>
                </div>
                <div class="policy-item">
                    <label>å°å†™å­—æ¯:</label>
                    <input type="checkbox" id="requireLower" checked>
                </div>
                <div class="policy-item">
                    <label>æ•°å­—:</label>
                    <input type="checkbox" id="requireNumbers" checked>
                </div>
                <div class="policy-item">
                    <label>ç‰¹æ®Šå­—ç¬¦:</label>
                    <input type="checkbox" id="requireSpecial" checked>
                </div>
            </div>
            <div>
                <h3>å®‰å…¨è®¾ç½®</h3>
                <div class="policy-item">
                    <label>å†å²è®°å½•æ•°:</label>
                    <input type="number" id="historyCount" value="5" min="0" max="20">
                </div>
                <div class="policy-item">
                    <label>è¿‡æœŸå¤©æ•°:</label>
                    <input type="number" id="expiryDays" value="90" min="0" max="3650">
                </div>
            </div>
            <div>
                <h3>é™åˆ¶è®¾ç½®</h3>
                <div class="policy-item">
                    <label>é˜²æ­¢å¸¸è§å¯†ç :</label>
                    <input type="checkbox" id="preventCommon" checked>
                </div>
                <div class="policy-item">
                    <label>é˜²æ­¢åŒ…å«ç”¨æˆ·å:</label>
                    <input type="checkbox" id="preventUsername" checked>
                </div>
            </div>
        </div>
        <button onclick="updatePasswordPolicy()">æ›´æ–°ç­–ç•¥</button>
        <div id="update-result"></div>
    </div>

    <div class="test-section">
        <h2>6. ç”¨æˆ·åˆ›å»ºæµ‹è¯•</h2>
        <div>
            <label>ç”¨æˆ·å:</label>
            <input type="text" id="newUsername" placeholder="æ–°ç”¨æˆ·å">
        </div>
        <div>
            <label>é‚®ç®±:</label>
            <input type="email" id="newEmail" placeholder="æ–°ç”¨æˆ·é‚®ç®±">
        </div>
        <div>
            <label>æ˜¾ç¤ºåç§°:</label>
            <input type="text" id="newDisplayName" placeholder="æ˜¾ç¤ºåç§°">
        </div>
        <div>
            <label>å¯†ç :</label>
            <input type="password" id="newPassword" placeholder="æ–°ç”¨æˆ·å¯†ç ">
        </div>
        <button onclick="createUser()">åˆ›å»ºç”¨æˆ·</button>
        <div id="create-result"></div>
    </div>

    <script>
        let accessToken = '';

        async function login() {
            const resultDiv = document.getElementById('login-result');
            resultDiv.innerHTML = '<span class="info">æ­£åœ¨ç™»å½•...</span>';
            
            try {
                const response = await fetch('http://localhost:8080/api/v1/console/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username: 'admin',
                        password: 'admin123'
                    })
                });

                const data = await response.json();
                
                if (response.ok && data.code === 200) {
                    accessToken = data.data.access_token;
                    resultDiv.innerHTML = `
                        <span class="success">âœ… ç™»å½•æˆåŠŸ</span>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <span class="error">âŒ ç™»å½•å¤±è´¥</span>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <span class="error">âŒ ç™»å½•é”™è¯¯: ${error.message}</span>
                `;
            }
        }

        async function getPasswordPolicy() {
            if (!accessToken) {
                document.getElementById('policy-result').innerHTML = 
                    '<span class="error">âŒ è¯·å…ˆç™»å½•</span>';
                return;
            }

            const resultDiv = document.getElementById('policy-result');
            resultDiv.innerHTML = '<span class="info">æ­£åœ¨è·å–å¯†ç ç­–ç•¥...</span>';
            
            try {
                const response = await fetch('http://localhost:8080/api/v1/console/password-policy', {
                    headers: {
                        'Authorization': `Bearer ${accessToken}`
                    }
                });

                const data = await response.json();
                
                if (response.ok && data.code === 200) {
                    resultDiv.innerHTML = `
                        <span class="success">âœ… è·å–å¯†ç ç­–ç•¥æˆåŠŸ</span>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <span class="error">âŒ è·å–å¯†ç ç­–ç•¥å¤±è´¥</span>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <span class="error">âŒ è·å–å¯†ç ç­–ç•¥é”™è¯¯: ${error.message}</span>
                `;
            }
        }

        async function validatePassword() {
            if (!accessToken) {
                document.getElementById('validation-result').innerHTML = 
                    '<span class="error">âŒ è¯·å…ˆç™»å½•</span>';
                return;
            }

            const password = document.getElementById('password').value;
            const username = document.getElementById('username').value;

            if (!password) {
                document.getElementById('validation-result').innerHTML = 
                    '<span class="error">âŒ è¯·è¾“å…¥å¯†ç </span>';
                return;
            }

            const resultDiv = document.getElementById('validation-result');
            resultDiv.innerHTML = '<span class="info">æ­£åœ¨éªŒè¯å¯†ç ...</span>';
            
            try {
                const response = await fetch('http://localhost:8080/api/v1/console/password-policy/validate', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${accessToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        password: password,
                        username: username
                    })
                });

                const data = await response.json();
                
                if (response.ok && data.code === 200) {
                    const result = data.data;
                    let strengthClass = `strength-${result.strength}`;
                    
                    resultDiv.innerHTML = `
                        <span class="${result.valid ? 'success' : 'error'}">
                            ${result.valid ? 'âœ… å¯†ç éªŒè¯é€šè¿‡' : 'âŒ å¯†ç éªŒè¯å¤±è´¥'}
                        </span>
                        <div class="password-strength ${strengthClass}">
                            <strong>å¯†ç å¼ºåº¦: ${result.strength_text} (${result.strength}/5)</strong>
                            <div>é¢œè‰²: ${result.strength_color}</div>
                        </div>
                        ${result.errors.length > 0 ? `
                            <div class="error">
                                <strong>é”™è¯¯:</strong>
                                <ul>${result.errors.map(err => `<li>${err}</li>`).join('')}</ul>
                            </div>
                        ` : ''}
                        ${result.warnings.length > 0 ? `
                            <div class="warning">
                                <strong>è­¦å‘Š:</strong>
                                <ul>${result.warnings.map(warn => `<li>${warn}</li>`).join('')}</ul>
                            </div>
                        ` : ''}
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <span class="error">âŒ å¯†ç éªŒè¯å¤±è´¥</span>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <span class="error">âŒ å¯†ç éªŒè¯é”™è¯¯: ${error.message}</span>
                `;
            }
        }

        async function generatePassword() {
            if (!accessToken) {
                document.getElementById('generate-result').innerHTML = 
                    '<span class="error">âŒ è¯·å…ˆç™»å½•</span>';
                return;
            }

            const resultDiv = document.getElementById('generate-result');
            resultDiv.innerHTML = '<span class="info">æ­£åœ¨ç”Ÿæˆå¯†ç ...</span>';
            
            try {
                const response = await fetch('http://localhost:8080/api/v1/console/password-policy/generate', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${accessToken}`
                    }
                });

                const data = await response.json();
                
                if (response.ok && data.code === 200) {
                    resultDiv.innerHTML = `
                        <span class="success">âœ… å¯†ç ç”ŸæˆæˆåŠŸ</span>
                        <div style="background: #e8f5e8; padding: 10px; border-radius: 5px; margin: 10px 0;">
                            <strong>ç”Ÿæˆçš„å¯†ç :</strong> <code>${data.data.password}</code>
                        </div>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <span class="error">âŒ å¯†ç ç”Ÿæˆå¤±è´¥</span>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <span class="error">âŒ å¯†ç ç”Ÿæˆé”™è¯¯: ${error.message}</span>
                `;
            }
        }

        async function updatePasswordPolicy() {
            if (!accessToken) {
                document.getElementById('update-result').innerHTML = 
                    '<span class="error">âŒ è¯·å…ˆç™»å½•</span>';
                return;
            }

            const resultDiv = document.getElementById('update-result');
            resultDiv.innerHTML = '<span class="info">æ­£åœ¨æ›´æ–°å¯†ç ç­–ç•¥...</span>';
            
            const policy = {
                min_length: parseInt(document.getElementById('minLength').value),
                max_length: parseInt(document.getElementById('maxLength').value),
                require_uppercase: document.getElementById('requireUpper').checked,
                require_lowercase: document.getElementById('requireLower').checked,
                require_numbers: document.getElementById('requireNumbers').checked,
                require_special_chars: document.getElementById('requireSpecial').checked,
                history_count: parseInt(document.getElementById('historyCount').value),
                expiry_days: parseInt(document.getElementById('expiryDays').value),
                prevent_common: document.getElementById('preventCommon').checked,
                prevent_username: document.getElementById('preventUsername').checked,
                is_active: true
            };
            
            try {
                const response = await fetch('http://localhost:8080/api/v1/console/password-policy', {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${accessToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(policy)
                });

                const data = await response.json();
                
                if (response.ok && data.code === 200) {
                    resultDiv.innerHTML = `
                        <span class="success">âœ… å¯†ç ç­–ç•¥æ›´æ–°æˆåŠŸ</span>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <span class="error">âŒ å¯†ç ç­–ç•¥æ›´æ–°å¤±è´¥</span>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <span class="error">âŒ å¯†ç ç­–ç•¥æ›´æ–°é”™è¯¯: ${error.message}</span>
                `;
            }
        }

        async function createUser() {
            if (!accessToken) {
                document.getElementById('create-result').innerHTML = 
                    '<span class="error">âŒ è¯·å…ˆç™»å½•</span>';
                return;
            }

            const username = document.getElementById('newUsername').value;
            const email = document.getElementById('newEmail').value;
            const displayName = document.getElementById('newDisplayName').value;
            const password = document.getElementById('newPassword').value;

            if (!username || !email || !displayName || !password) {
                document.getElementById('create-result').innerHTML = 
                    '<span class="error">âŒ è¯·å¡«å†™æ‰€æœ‰å­—æ®µ</span>';
                return;
            }

            const resultDiv = document.getElementById('create-result');
            resultDiv.innerHTML = '<span class="info">æ­£åœ¨åˆ›å»ºç”¨æˆ·...</span>';
            
            try {
                const response = await fetch('http://localhost:8080/api/v1/console/users', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${accessToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username: username,
                        email: email,
                        display_name: displayName,
                        password: password,
                        organization_id: 'eed08673-a72b-4751-85cf-41993e48bfbb'
                    })
                });

                const data = await response.json();
                
                if (response.ok && data.code === 201) {
                    resultDiv.innerHTML = `
                        <span class="success">âœ… ç”¨æˆ·åˆ›å»ºæˆåŠŸ</span>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <span class="error">âŒ ç”¨æˆ·åˆ›å»ºå¤±è´¥</span>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <span class="error">âŒ ç”¨æˆ·åˆ›å»ºé”™è¯¯: ${error.message}</span>
                `;
            }
        }
    </script>
</body>
</html>
